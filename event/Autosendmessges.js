import axios from 'axios';
import fs from 'fs';
import path from 'path';

// Ø¬Ù„Ø¨ ÙˆØ­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ cache
async function fetchAndSaveImage(imageURL, imageName) {
  const imagePath = path.join(process.cwd(), 'cache', imageName);
  try {
    const response = await axios({
      url: imageURL,
      method: 'GET',
      responseType: 'stream',
    });

    const writer = fs.createWriteStream(imagePath);
    response.data.pipe(writer);

    return new Promise((resolve, reject) => {
      writer.on('finish', () => resolve(imagePath));
      writer.on('error', reject);
    });
  } catch (error) {
    console.error('Error fetching image:', error);
    return null;
  }
}

export default {
  name: "autosendmessges",
  execute: async ({ api, event, Threads }) => {
    try {
      // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
      const threadsData = await Threads.find(event.threadID);
      const threads = threadsData?.data?.data || {};

      // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©
      if (!threads) {
        await Threads.create(event.threadID);
      }

      // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙØ§Ø±ØºØ©ØŒ Ø£ÙˆÙ‚Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
      if (!Object.keys(threads).length) return;

      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ù„ØµÙˆØ± ÙŠÙˆÙ…ÙŠÙ‹Ø§
      setInterval(() => {
        sendScheduledMessages(api, event.threadID);
      }, 86400000); // ØªÙƒØ±Ø§Ø± ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©

    } catch (error) {
      console.error("Error handling thread update:", error);
    }
  },
};

// Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¬Ø¯ÙˆÙ„Ø© Ù…Ø¹ Ø§Ù„ØµÙˆØ±
async function sendScheduledMessages(api, threadID) {
  const messagesWithImages = [
    
    { delay: 3600000, text: `ÙˆÙ„ÙŠØ³ ÙƒÙ„ Ù…Ø§ØµØ±ÙÙ‡ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ùƒ Ø´Ø±ÙŒ Ù„Ùƒ Ù„Ø¹Ù„Ùƒ Ø£Ù†Øª Ø§Ù„Ø®ÙŠØ± Ø§Ù„Ø°ÙŠ Ù„Ø§ ÙŠØ³ØªØ­Ù‚ÙˆÙ†Ù‡ ðŸ’™ðŸ’™.
ð‘¨ð’ð’… ð’ð’ð’• ð’†ð’—ð’†ð’“ð’šð’•ð’‰ð’Šð’ð’ˆ ð’•ð’‰ð’‚ð’• ð‘®ð’ð’… ð’”ð’‘ð’†ð’ð’• ð’‡ð’“ð’ð’Ž ð’šð’ð’– ð’Šð’” ð’†ð’—ð’Šð’ ð’‡ð’ð’“ ð’šð’ð’–, ð’‘ð’†ð’“ð’‰ð’‚ð’‘ð’” ð’šð’ð’– ð’‚ð’“ð’† ð’•ð’‰ð’† ð’ˆð’ð’ð’… ð’•ð’‰ð’‚ð’• ð’•ð’‰ð’†ð’š ð’…ð’ ð’ð’ð’• ð’…ð’†ð’”ð’†ð’“ð’—ð’†.ðŸ’™ðŸ’™` ,
 imageURL: "https://i.imgur.com/L39Bu27.jpeg", imageName: "image1.jpg" },
    { delay: 7200000, text: `Ù„Ø§ Ø´ÙŠ ÙŠØ¨Ù‚Ù€Ù€Ù€Ù‰ Ù„Ù„Ø£Ø¨Ø¯ Ø­ØªÙ‰ Ø§Ù„Ø´Ù…Ø³ Ø³Ù€ØªÚ¯Ø³Ø± Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† ÙŠÙˆÙ…Ø§Ù‹ ÙˆØªØ´Ø±Ù‚ ØºØ±Ø¨Ø§Ù‹ Ù„ØªØ¹Ù„Ù† Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ðŸŒ·âœ¨
ð‘µð‘¶ð‘»ð‘¯ð‘°ð‘µð‘® ð‘¹ð‘¬ð‘´ð‘¨ð‘°ð‘µð‘º ð‘­ð‘¶ð‘¹ð‘¬ð‘½ð‘¬ð‘¹, ð‘¼ð‘µð‘»ð‘°ð‘³ ð‘»ð‘¯ð‘¬ ð‘ºð‘¼ð‘µ ð‘¾ð‘°ð‘³ð‘³ ð‘©ð‘¹ð‘¬ð‘¨ð‘² ðŸŒ·âœ¨`, imageURL: "https://i.imgur.com/lTm8CtH.jpeg", imageName: "image2.jpg" },
    { delay: 10800000, text: `-ð‘«ð’ð’'ð’• ð’•ð’“ð’–ð’”ð’• ð’”ð’ð’Žð’†ð’ð’ð’† ð’‹ð’–ð’”ð’• ð’ƒð’†ð’„ð’‚ð’–ð’”ð’† ð’šð’ð’– ð’ð’Šð’Œð’† ð’•ð’‚ð’ð’Œð’Šð’ð’ˆð‘¾ð’Šð’•ð’‰ ð’‰ð’Šð’Ž, ð’ð’Šð’‡ð’† ð’‰ð’‚ð’” ð’ƒð’†ð’„ð’ð’Žð’† ð’‚ð’”ð’‘ð’†ð’„ð’•ð’” ð’•ð’‰ð’‚ð’• ð’šð’ð’– ð’„ð’‚ð’ ð’„ð’ð’ð’•ð’†ð’Žð’‘ð’ð’‚ð’•ð’† ð’˜ð’†ð’ð’. ðŸ¦‹âœ¨
-Ù„Ø§ØªØ«Ù‚ Ø¨Ø´Ø®Øµ Ù„Ù…Ø¬Ø±Ø¯ Ø§Ø¹Ø¬Ø¨Ùƒ Ø§Ù„Ø­Ø¯ÙŠØ«
Ù…Ø¹Ø© ÙØ§Ù„Ø­ÙŠØ§Ø© Ø£ØµØ¨Ø­Øª Ù…Ø¸Ø§Ù‡Ø± ØªØ§Ù…Ù„ÙˆÙ‡Ø§ Ø¬ÙŠØ¯Ø§ .ðŸ¦‹âœ¨` , imageURL: "https://i.imgur.com/2GgRzqu.jpeg", imageName: "image3.jpg" },
    { delay: 10800000, text: `"â€Ø§Ù„Ù†Ø¸Ø±Ø§Øª Ù‚Ø§Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ø®ØªØµØ§Ø± Ø­Ø¯ÙŠØ« 
Ù…Ù† Ø³Ø¨Ø¹ÙŠÙ† Ø£Ù„Ù ÙƒÙ„Ù…Ø©.ðŸ¤Ž
â€œð‘³ð’ð’ð’Œð’” ð’„ð’‚ð’ ð’”ð’‰ð’ð’“ð’•ð’†ð’ ð’‚ ð’„ð’ð’ð’—ð’†ð’“ð’”ð’‚ð’•ð’Šð’ð’ 
ð‘ºð’†ð’—ð’†ð’ð’•ð’š ð’•ð’‰ð’ð’–ð’”ð’‚ð’ð’… ð’˜ð’ð’“ð’…ð’”ðŸ¤Ž` , imageURL: "https://i.imgur.com/cl9dHRU.png", imageName: "image4.jpg" },
    { delay: 14400000, text: `ð‘° ð’ˆð’‚ð’—ð’† ð’Žð’š ð’‡ð’†ð’†ð’ð’Šð’ð’ˆð’” ð’‚ð’ð’… ð’†ð’ð’†ð’“ð’ˆð’š ð’ð’ð’„ð’†, ð’‚ð’ð’… ð’‰ð’†ð’“ð’† ð‘° ð’‡ð’†ð’ð’ ð’˜ð’Šð’•ð’‰ ð’Žð’š ð’˜ð’‰ð’ð’ð’† ð’˜ð’†ð’Šð’ˆð’‰ð’• ð’‚ð’ð’… ð’„ð’ð’–ð’ð’… ð’ð’ð’• ð’ˆð’†ð’• ð’–ð’‘. ðŸ–¤
Ù„Ù‚Ø¯ ÙˆÙ‡Ø¨ØªÙ Ù…Ø´Ø§Ø¹Ø±ÙŠ Ùˆ Ø·Ø§Ù‚ØªÙŠ Ù…Ø±Ø©Ù‹ ÙˆØ§Ø­Ø¯Ø© ÙˆÙ‡Ø§ Ø£Ù†Ø§ Ø³ÙŽÙ‚Ø·Øª Ø¨Ø«Ù‚Ù„ÙŠ ÙƒÙ„Ù‡ Ùˆ Ù„Ù… Ø£Ø³ØªØ·ÙŠØ¹ Ø§Ù„Ù†Ù‡ÙˆØ¶`, imageURL: "https://i.imgur.com/tb5JrpZ.jpeg", imageName: "image5.jpg" },
    { delay: 18000000, text:  `Ù„Ø§ ÙŠÙ€Ù‡Ù€Ù…Ù€Ù†ÙŠ Ø¥Ù† ØºØ§Ø¯Ø±Ù†Ù€ÙŠ Ø§Ù„Ù€Ø¬Ù€Ù…ÙŠÙ€Ø¹ ØŒ ÙÙ€Ù…Ù€Ù†Ø° Ø§Ù„Ù€Ø¨Ù€Ø¯Ø§ÙŠÙ€Ø© Ø§Ø±Ø³Ù€Ù… Ù…Ù€Ø³Ù€ØªÙ€Ù‚Ø¨Ù„Ø§ Ù„Ø§ÙŠÙ€ÙˆØ¬Ù€Ø¯ ÙÙŠÙ‡ Ø§Ø­Ø¯..ðŸ¤ðŸª

ð‘±ð’† ð’Žð’† ð’‡ð’Šð’„ð’‰ð’† ð’’ð’–ð’† ð’•ð’ð’–ð’• ð’ð’† ð’Žð’ð’ð’…ð’† ð’Žð’† ð’•ð’“ð’‚ð’‰ð’Šð’”ð’”ð’†, ð’…ð’†ð’‘ð’–ð’Šð’” ð’ð’† ð’…Ã©ð’ƒð’–ð’• ð’‹ð’† ð’…ð’†ð’”ð’”ð’Šð’ð’† ð’–ð’ ð’‚ð’—ð’†ð’ð’Šð’“ ð’Ã¹ ð’Šð’ ð’'ð’š ð’‚ ð’‘ð’†ð’“ð’”ð’ð’ð’ð’†..ðŸ¤ðŸªðŸ’—ðŸ¯`, imageURL: "https://i.imgur.com/cObPoNO.jpeg", imageName: "image5.jpg" },
{ delay: 21600000, text: `ð‘¯ð’ð’˜ð’†ð’—ð’†ð’“ ð’…ð’Šð’‡ð’‡ð’Šð’„ð’–ð’ð’• ð’ð’Šð’‡ð’† ð’Žð’‚ð’š ð’”ð’†ð’†ð’Ž, ð’•ð’‰ð’†ð’“ð’† ð’Šð’” ð’‚ð’ð’˜ð’‚ð’šð’” ð’”ð’ð’Žð’†ð’•ð’‰ð’Šð’ð’ˆ ð’šð’ð’– ð’„ð’‚ð’ ð’…ð’ ð’‚ð’ð’… ð’”ð’–ð’„ð’„ð’†ð’†ð’… ð’‚ð’•ðŸ©µâœ¨
â€Ù…Ù‡Ù…Ø§ Ø¨Ø¯Øª Ø§Ù„Ø­ÙŠØ§Ø© ØµØ¹Ø¨Ù‡ØŒ ÙŠÙˆØ¬Ø¯ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø´ÙŠØ¡ÙŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù†Ø¬Ø§Ø­ ÙÙŠÙ‡.ðŸ©µâœ¨`, imageURL: "https://i.imgur.com/rAfXyDp.jpeg", imageName: "image5.jpg" },
    { delay: 25200000, text: `ð˜¾ð™§ð™®ð™žð™£ð™œ ið™®s ð™£ð™¤ð™© ð™– ð™¨ð™žð™œð™£ ð™¤ð™› ð™¬ð™šð™–ð™ ð™£ð™šð™¨ð™¨. ð™Žð™¤ð™¢ð™šð™©ð™žð™¢ð™šð™¨ ð™– ð™¥ð™šð™§ð™¨ð™¤ð™£ ð™˜ð™§ð™žð™šð™¨ ð™—ð™šð™˜ð™–ð™ªð™¨ð™š ð™ð™š ð™ð™–ð™¨ ð™—ð™šð™šð™£ ð™¨ð™©ð™§ð™¤ð™£ð™œ ð™›ð™¤ð™§ ð™– ð™¡ð™¤ð™£ð™œ ð™©ð™žð™¢ð™š. ðŸ–¤ðŸ¥€
Ù„ÙŠØ³ Ø§Ù„Ø¨ÙƒØ§Ø¡ Ø¯Ù„ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¶Ø¹ÙØŒ Ø£Ø­ÙŠØ§Ù†Ù‹Ø§ ÙŠØ¨ÙƒÙŠ Ø§Ù„Ø´Ø®Øµ Ù„Ø£Ù†Ù‡ ÙƒØ§Ù† Ù‚ÙˆÙŠ Ù„ÙØªØ±Ø© Ø·ÙˆÙŠÙ„Ø©.ðŸ–¤ðŸ¥€`, imageURL: "https://i.imgur.com/2lJlHJA.jpeg", imageName: "image5.jpg" },
{ delay: 28800000, text:`â€"Ø£Ø¹ØªÙ‚Ø¯ Ø£Ù† Ø¨Ø¹Ø¶ Ø§Ù„Ù†Ø§Ø³ Ù‚Ø¯ Ù‚Ø¶ÙˆØ§ Ø§Ù„ÙˆÙ‚Øª Ù…Ø¹ÙŠ Ù„Ø£Ù†Ù‡Ù… ÙÙ‚Ø· ÙƒØ§Ù†ÙˆØ§ ÙˆØ­ÙŠØ¯ÙŠÙ†".ðŸ–¤ðŸ¥€
â€œð™„ ð™©ð™ð™žð™£ð™  ð™¨ð™¤ð™¢ð™š ð™¥ð™šð™¤ð™¥ð™¡ð™š ð™¨ð™¥ð™šð™£ð™© ð™©ð™žð™¢ð™š ð™¬ð™žð™©ð™ ð™¢ð™š ð™—ð™šð™˜ð™–ð™ªð™¨ð™š ð™©ð™ð™šð™® ð™¬ð™šð™§ð™š ð™Ÿð™ªð™¨ð™© ð™¡ð™¤ð™£ð™šð™¡ð™®.â€ðŸ–¤ðŸ¥€`, imageURL: "https://i.imgur.com/tHVgnAv.jpeg", imageName: "image5.jpg" },
    { delay: 32400000, text:  `Ø£Ù†Ø§ Ø°Ù„Ùƒ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ ÙŠØ±Ø´Ø¯ Ø§Ù„ØªØ§Ø¦Ù‡ÙŠÙ† ÙˆÙ„Ø§ ÙŠØ¹Ø±Ù ÙƒÙŠÙ ÙŠØºØ§Ø¯Ø± Ø§Ù„Ù…ØªØ§Ù‡Ø©.ðŸ¤ŽðŸŒª

ð’Š ð’‚ð’Ž ð’•ð’‰ð’† ð’‘ð’†ð’“ð’”ð’ð’ ð’˜ð’‰ð’ ð’ˆð’–ð’Šð’…ð’†ð’” ð’•ð’‰ð’† ð’˜ð’‚ð’ð’…ð’†ð’“ð’Šð’ð’ˆ ð’‚ð’ð’… ð’…ð’ ð’ð’ð’• ð’Œð’ð’ð’˜ ð’‰ð’ð’˜ ð’•ð’ ð’ð’†ð’‚ð’—ð’† ð’•ð’‰ð’† ð’Žð’‚ð’›ð’†.ðŸ¤ŽðŸŒª` , imageURL: "https://i.imgur.com/4HIFOiZ.jpeg", imageName: "image5.jpg" },
{ delay: 36000000, text:`Ø£Ù† ÙŠÙŽÙƒÙˆÙ† Ù„Ùƒ ØµÙŽØ¯ÙŠÙ‚ ÙŠÙŽØ±Ø§Ùƒ ÙˆÙƒØ£Ù†Ù‘Ùƒ Ø§Ù„Ø®ÙŠØ± ÙÙŠ
Ù‡Ø°Ù‡Ù Ø§Ù„Ø£Ø±Ø¶ØŒ Ø´ÙØ¹ÙˆØ± Ù„Ø§ ÙŠÙÙ…ÙƒÙ†Ùƒ Ø£Ù† ØªÙŽØ¶Ø¹Ù‡ ÙÙŠ
ÙƒÙ„Ù…Ø§ØªÙ Ù…ÙÙ†Ø§Ø³ÙØ¨Ø©.ðŸ’–"
ð™ð™¤ ð™ð™–ð™«ð™š ð™– ð™›ð™§ð™žð™šð™£ð™™ ð™¬ð™ð™¤ ð™¨ð™šð™šð™¨ ð™®ð™¤ð™ª ð™–ð™¨ ð™©ð™ð™š ð™—ð™šð™¨ð™© ð™žð™£ ð™®ð™¤ð™ª
ð™ð™ð™žð™¨ ð™šð™–ð™§ð™©ð™, ð™– ð™›ð™šð™šð™¡ð™žð™£ð™œ ð™®ð™¤ð™ª ð™˜ð™–ð™£'ð™© ð™¥ð™ªð™© ð™žð™£
ð™Žð™ªð™žð™©ð™–ð™—ð™¡ð™š ð™¬ð™¤ð™§ð™™ð™¨.ðŸ’–` , imageURL: "https://i.imgur.com/O7NTeg8.jpeg", imageName: "image5.jpg" },
    { delay: 39600000, text: `-Ø§Ù„ØºØ§Ø¦Ø¨ÙˆÙ† Ø¨Ù„Ø§ Ø¹Ø°Ø± ÙƒØ§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† Ø¨Ù„Ø§ ÙØ§Ø¦Ø¯Ø© ØŒ ÙƒÙ„Ø§Ù‡Ù…Ø§ ÙŠØ´ØºÙ„ Ø­ÙŠØ²Ø§Ù‹ ï»» ÙŠØ³ØªØ­Ù‚Ù‡.ðŸ’¨
- ð‘‡â„Žð‘œð‘ ð‘’ ð‘¤â„Žð‘œ ð‘Žð‘Ÿð‘’ ð‘Žð‘ð‘ ð‘’ð‘›ð‘¡ ð‘¤ð‘–ð‘¡â„Žð‘œð‘¢ð‘¡ ð‘’ð‘¥ð‘ð‘¢ð‘ ð‘’ ð‘Žð‘Ÿð‘’ ð‘™ð‘–ð‘˜ð‘’ ð‘¡â„Žð‘œð‘ ð‘’ ð‘¤â„Žð‘œ ð‘Žð‘Ÿð‘’ ð‘ð‘Ÿð‘’ð‘ ð‘’ð‘›ð‘¡ ð‘¤ð‘–ð‘¡â„Žð‘œð‘¢ð‘¡ ð‘ð‘’ð‘›ð‘’ð‘“ð‘–ð‘¡. ðµð‘œð‘¡â„Ž ð‘œð‘“ ð‘¡â„Žð‘’ð‘š ð‘œð‘ð‘ð‘¢ð‘ð‘¦ ð‘ ð‘ð‘Žð‘ð‘’ ð‘¡â„Žð‘Žð‘¡ ð‘¡â„Žð‘’ð‘¦ ð‘‘ð‘œ ð‘›ð‘œð‘¡ ð‘‘ð‘’ð‘ ð‘’ð‘Ÿð‘£ð‘’.ðŸ’¨` , imageURL: "https://i.imgur.com/2B7aLoZ.jpeg", imageName: "image5.jpg" },
  ];

  for (const msg of messagesWithImages) {
    await new Promise(resolve => setTimeout(resolve, msg.delay));

    const imagePath = await fetchAndSaveImage(msg.imageURL, msg.imageName);

    if (imagePath) {
      api.sendMessage({
        body: msg.text,
        attachment: fs.createReadStream(imagePath)
      }, threadID);
    } else {
      api.sendMessage(msg.text, threadID);
    }
  }
        }
